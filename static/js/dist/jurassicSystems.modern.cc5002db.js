var A=["access","aaccess"];function f(e){if(!e)return"";let o=e.trim();if(!o)return"";let n=o.toLowerCase();return A.includes(n)?"access":n}var h={beep:[{src:"/snd/beep.mp3",type:"audio/mpeg"},{src:"/snd/beep.ogg",type:"audio/ogg"},{src:"/snd/beep.wav",type:"audio/wav"}],lockDown:[{src:"/snd/lockDown.mp3",type:"audio/mpeg"},{src:"/snd/lockDown.ogg",type:"audio/ogg"},{src:"/snd/lockDown.wav",type:"audio/wav"}],dennisMusic:[{src:"/snd/dennisMusic.mp3",type:"audio/mpeg"},{src:"/snd/dennisMusic.ogg",type:"audio/ogg"},{src:"/snd/dennisMusic.wav",type:"audio/wav"}]},T=["theKingBlur.jpg","theKingFocus.jpg","macHDBlur.jpg","asciiNewman.jpg","zebraGirlWindow.jpg"];function b(e,{loop:o=!1}={}){let n=document.createElement("audio");n.preload="auto",n.loop=o,n.setAttribute("aria-hidden","true"),n.style.display="none";for(let t of e){let s=document.createElement("source");s.src=t.src,t.type&&(s.type=t.type),n.appendChild(s)}return document.body.appendChild(n),{play(){try{n.currentTime=0}catch{}let t=n.play();t instanceof Promise&&t.catch(()=>{})},stop(){n.pause();try{n.currentTime=0}catch{}}}}function C(){return{beep:b(h.beep),lockDown:b(h.lockDown),dennisMusic:b(h.dennisMusic,{loop:!0})}}function g(e){e&&(e.scrollTop=e.scrollHeight)}function D(e,o){e&&(e.style.transition=`opacity ${o}ms ease`,e.style.opacity="0",window.setTimeout(()=>{e.style.display="none",e.style.transition="",e.style.opacity=""},o))}function L(){for(let e of T){let o=new Image;o.src=`/img/${e}`}}function w(e=document){e.querySelectorAll(".cursor").forEach(o=>{o.classList.remove("active-cursor")}),e.querySelectorAll(".buffer").forEach(o=>{o.blur()})}function O(e,o){let n=e.querySelector(".window-bar");if(!n)return;let t=0,s=0,i=r=>{e.style.left=`${r.clientX-t}px`,e.style.top=`${r.clientY-s}px`},c=r=>{e.classList.remove("dragging"),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",c),r.pointerId!==void 0&&n.releasePointerCapture(r.pointerId)};n.addEventListener("pointerdown",r=>{if(r.button!==0&&r.pointerType!=="touch")return;let d=e.getBoundingClientRect();t=r.clientX-d.left,s=r.clientY-d.top,e.classList.add("dragging"),e.style.zIndex=String(o()),window.addEventListener("pointermove",i),window.addEventListener("pointerup",c),r.pointerId!==void 0&&n.setPointerCapture(r.pointerId),r.preventDefault()})}function P(e,o,n){let t=document.getElementById(e);if(!t)return;t.style.opacity="1",t.style.display="block";let s=!0,i=window.setInterval(()=>{t.style.opacity=s?"1":"0",s=!s},o);window.setTimeout(()=>{window.clearInterval(i),t.style.opacity="0",t.style.display=""},n)}function N(){return{accessAttempts:0,active:null,commands:new Map,maxIndex:1,musicOn:!1,sounds:C()}}function l(e,o){let n=f(o.name);!n||e.commands.has(n)||e.commands.set(n,{...o,name:n})}function B(e,o){let n=e?.querySelector(".command-history");if(!n)return;let t=document.createElement("div");t.className="entered-command",t.textContent=`> ${o}`,n.append(t)}function p(e){let o=document.getElementById("main-input");if(!o)return;typeof e=="string"?o.insertAdjacentHTML("beforeend",e):e instanceof Node&&o.append(e);let n=document.getElementById("main-inner");g(n)}function m(e,o="span"){let n=document.createElement(o);return n.textContent=e,p(n),n}function M(e){let o=document.createElement("div");return o.innerHTML=`
    <div>${e} containment enclosure....</div>
    <table id="system-output"><tbody>
      <tr><td>Security</td><td>[OK]</td></tr>
      <tr><td>Fence</td><td>[OK]</td></tr>
      <tr><td>Feeding Pavilion</td><td>[OK]</td></tr>
    </tbody></table>
  `,o}function j(e){l(e,{name:"music",summary:"turn background music on or off",manPage:["SYNOPSIS","	music [on|off]","","DESCRIPTION","	Manage the state of the 'Dennis Steals the Embryo' music. Use the 'on' state for","	increased epicness.","","AUTHOR",'	Written by <a href="https://tully.io">Tully Robinson</a>.'].join(`
`),execute(o,n){let[,t=""]=n.trim().split(/ +/);if(!t||!/^(?:on|off)$/i.test(t)){m("music: must specify state [on|off]");return}t.toLowerCase()==="on"?(o.musicOn||o.sounds.dennisMusic.play(),o.musicOn=!0):(o.sounds.dennisMusic.stop(),o.musicOn=!1)}}),l(e,{name:"access",summary:"access a target environment on the Jurassic Systems grid",manPage:["SYNOPSIS","	access [SYSTEM_NAME] [MAGIC_WORD]","","DESCRIPTION","	Gain read and write access to a specified environment.","","AUTHOR","	Written by Dennis Nedry."].join(`
`),execute(o,n){let t=n.trim().split(/ +/),s=t[1]??"",i=t.length>2?t[t.length-1]:"";if(!s){m("access: must specify target system");return}if(t.length>2&&i.toLowerCase()==="please"){let a=document.createElement("img");a.id="asciiNewman",a.src="/img/asciiNewman.jpg",a.alt="ASCII art of Dennis Nedry",a.addEventListener("load",()=>{let u=document.querySelector("#main-terminal .inner-wrap");g(u)}),p(a);return}if(m("access: PERMISSION DENIED."),o.sounds.beep.play(),o.accessAttempts+=1,o.accessAttempts<3)return;document.getElementById("main-prompt")?.classList.add("hide"),w();let r;m("...and...","span").classList.add("and-message"),window.setTimeout(()=>{o.sounds.lockDown.play()},1e3),window.setTimeout(()=>{let a=document.getElementById("environment");if(!a)return;let v=(parseFloat(window.getComputedStyle(a).left||"0")||0)+3e3;a.style.transition="left 2000ms ease",a.style.left=`${v}px`;let E=()=>{a.removeEventListener("transitionend",E),window.setTimeout(()=>{let S=document.getElementById("the-king-video");if(S){let y=S.play();y instanceof Promise&&y.catch(()=>{})}window.clearInterval(r);let k=document.getElementById("irix-desktop"),x=document.getElementById("mac-hd-window"),I=document.getElementById("the-king-window");k&&(k.style.display="none"),x&&(x.style.backgroundImage="url('/img/macHDBlur.jpg')"),I&&(I.style.display="block",I.setAttribute("aria-hidden","false")),window.setTimeout(()=>{let y=document.getElementById("home-key");y&&(y.style.zIndex="64000")},1e4)},2e3)};a.addEventListener("transitionend",E)},2e3),window.setTimeout(()=>{r=window.setInterval(()=>{let a=document.createElement("div");a.textContent="YOU DIDN'T SAY THE MAGIC WORD!",p(a)},50)},1e3)}}),l(e,{name:"system",summary:"check a system's current status",manPage:["SYNOPSIS","	system [SYSTEM_NAME]","","DESCRIPTION","	Check the input system and return each sector's current status.","","AUTHOR","	Written by Dennis Nedry."].join(`
`),execute(o,n){let s=n.trim().split(/ +/)[1]??"";if(!s){p("<span>system: must specify target system</span>");return}let i=`${s.replace(/s$/i,"")}`,r=`${i.charAt(0).toUpperCase()}${i.slice(1)}`.replace(/[&<>"]+/g,u=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[u]),d=M(r);p(d);let a=document.querySelector("#main-terminal .inner-wrap");o.sounds.beep.play(),window.setTimeout(()=>{o.sounds.beep.play(),m("System Halt!","div"),g(a),document.getElementById("main-prompt")?.classList.remove("hide")},900)}}),l(e,{name:"ls",summary:"list files in the current directory",manPage:["SYNOPSIS","	ls [FILE] ...","","DESCRIPTION","	List information about the FILEs (the current directory by default).","","AUTHOR","	Written by Richard Stallman and David MacKenzie."].join(`
`),execute(){m("zebraGirl.jpg","div")}}),l(e,{name:"display",summary:"display image files (hint: use ls to find a 'file')",manPage:["SYNOPSIS","	display file ...","","DESCRIPTION","	Display is a machine architecture independent image processing and display program. It can display an image on any workstation screen running an X server.","","AUTHOR","	John Cristy, ImageMagick Studio."].join(`
`),execute(o,n){if(n.trim().split(/ +/).length<2){m("display: no file specified");return}/zebraGirl\.jpg/i.test(n)&&window.setTimeout(()=>{let s=document.getElementById("zebra-girl");s&&(s.style.zIndex=String(o.maxIndex+=1),s.style.display="block",s.setAttribute("aria-hidden","false"),w())},300)}}),l(e,{name:"keychecks",summary:"display system level command history",manPage:["SYNOPSIS","	keychecks","","DESCRIPTION","	A system level command log used for accountability purposes. keychecks must be activated or deactivated via the main board."].join(`
`),execute(){let o=["13,42,121,32,88,77,19,13,44,52,77,90,13,99,13,100,13,109,55,103,144,13,99,87,60,13,44,12,09,13,43,63,13,46,57,89,103,122,13,44,52,88,931,13,21,13,57,98,100,102,103,13,112,13,146,13,13,13,77,67,88,23,13,13","system","nedry","go to command level","nedry","040/#xy/67&","mr goodbytes","security","keycheck off","safety off","sl off","security","whte_rbt.obj"].join(`
`);m(o,"div")}}),l(e,{name:"man",summary:"display reference manual for a given command",manPage:["SYNOPSIS","	man title ...","","DESCRIPTION","	man locates and prints the titled entries from the on-line reference manuals."].join(`
`),execute(o,n){let s=n.trim().split(/ +/)[1]??"";if(!s){m("What manual page do you want?");return}let i=f(s);if(o.commands.has(i))p(o.commands.get(i).manPage.replace(/\n/g,"<br>"));else{let c=s.replace(/[&<>"]+/g,r=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[r]);m(`No manual entry for ${c}`)}}}),l(e,{name:"help",summary:"list available commands",manPage:["SYNOPSIS","	help","","DESCRIPTION","	Display a command summary for Jurassic Systems.","","AUTHOR",'	Written by <a href="https://tully.io">Tully Robinson</a>.'].join(`
`),execute(o){for(let[,n]of o.commands){let t=document.createElement("div");t.textContent=`${n.name} - ${n.summary}`,p(t)}}})}function H(e){document.querySelectorAll(".irix-window").forEach(t=>{O(t,()=>(e.maxIndex+=1,e.maxIndex)),t.addEventListener("click",s=>{s.stopPropagation(),w(),e.active=t,t.querySelector(".buffer")?.focus(),t.style.zIndex=String(e.maxIndex+=1),t.querySelectorAll(".cursor").forEach(c=>{c.classList.add("active-cursor")})})}),document.querySelectorAll(".irix-window .buffer").forEach(t=>{t.addEventListener("keydown",s=>{let i=t.closest(".irix-window");if(!i)return;if(s.key==="Enter"){s.preventDefault();let r=t.value;if(t.value="",B(i,r||" "),i.id==="chess-terminal"){let d=document.getElementById("curr-chess-input");d&&(d.textContent="")}else{let d=document.getElementById("curr-main-input");d&&(d.textContent="");let a=f(r.trim().split(/ +/)[0]??""),u=e.commands.get(a);u&&typeof u.execute=="function"?u.execute(e,r):a&&m(`${r.trim().split(/ +/)[0]}: command not found`,"div")}}let c=i.querySelector(".inner-wrap");g(c)}),t.addEventListener("input",()=>{let s=t.closest(".irix-window");if(s)if(s.id==="chess-terminal"){let i=document.getElementById("curr-chess-input");i&&(i.textContent=t.value)}else{let i=document.getElementById("curr-main-input");i&&(i.textContent=t.value)}})})}function $(){window.setTimeout(()=>{document.getElementById("irix-boot")?.remove();let o=document.getElementById("main-buffer");if(o?.focus(),!window.location.pathname.includes("system")){o?.blur();let n=document.getElementById("intro");if(n){n.style.display="block",n.setAttribute("aria-hidden","false");let t=document.getElementById("continue-button"),s=document.getElementById("intro-scene"),i=()=>{s instanceof HTMLIFrameElement&&(s.src=""),D(n,1e3),n.setAttribute("aria-hidden","true")};n.addEventListener("click",i,{once:!0}),t&&(t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label","Continue to console"),t.addEventListener("click",c=>{c.stopPropagation(),i()}),t.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),i())}))}}},4500)}function R(e){document.body.addEventListener("click",()=>{w()}),window.addEventListener("keydown",n=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(n.key)&&n.preventDefault()}),document.getElementById("apple-desktop")?.addEventListener("click",n=>{let t=n.target;if(!(t instanceof Element))return;let s=t.closest(".mac-window");(!s||s.id!=="the-king-window")&&P("the-king-blur",50,450)})}function W(){L();let e=N();j(e),H(e),$(),R(e)}document.addEventListener("DOMContentLoaded",W);
