(()=>{var v=["access","aaccess"];function g(e){if(!e)return"";let t=e.trim();if(!t)return"";let s=t.toLowerCase();return v.includes(s)?"access":s}var E={beep:[{src:"/snd/beep.mp3",type:"audio/mpeg"},{src:"/snd/beep.ogg",type:"audio/ogg"},{src:"/snd/beep.wav",type:"audio/wav"}],lockDown:[{src:"/snd/lockDown.mp3",type:"audio/mpeg"},{src:"/snd/lockDown.ogg",type:"audio/ogg"},{src:"/snd/lockDown.wav",type:"audio/wav"}],dennisMusic:[{src:"/snd/dennisMusic.mp3",type:"audio/mpeg"},{src:"/snd/dennisMusic.ogg",type:"audio/ogg"},{src:"/snd/dennisMusic.wav",type:"audio/wav"}]},C=["theKingBlur.jpg","theKingFocus.jpg","macHDBlur.jpg","asciiNewman.jpg","zebraGirlWindow.jpg"];function S(e,{loop:t=!1}={}){let s=document.createElement("audio");s.preload="auto",s.loop=t,s.setAttribute("aria-hidden","true"),s.style.display="none";for(let n of e){let o=document.createElement("source");o.src=n.src,n.type&&(o.type=n.type),s.appendChild(o)}return document.body.appendChild(s),{play(){try{s.currentTime=0}catch(o){}let n=s.play();n instanceof Promise&&n.catch(()=>{})},stop(){s.pause();try{s.currentTime=0}catch(n){}}}}function L(){return{beep:S(E.beep),lockDown:S(E.lockDown),dennisMusic:S(E.dennisMusic,{loop:!0})}}function w(e){e&&(e.scrollTop=e.scrollHeight)}function D(e,t){e&&(e.style.transition=`opacity ${t}ms ease`,e.style.opacity="0",window.setTimeout(()=>{e.style.display="none",e.style.transition="",e.style.opacity=""},t))}function O(){for(let e of C){let t=new Image;t.src=`/img/${e}`}}function I(e=document){e.querySelectorAll(".cursor").forEach(t=>{t.classList.remove("active-cursor")}),e.querySelectorAll(".buffer").forEach(t=>{t.blur()})}function P(e,t){let s=e.querySelector(".window-bar");if(!s)return;let n=0,o=0,i=r=>{e.style.left=`${r.clientX-n}px`,e.style.top=`${r.clientY-o}px`},c=r=>{e.classList.remove("dragging"),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",c),r.pointerId!==void 0&&s.releasePointerCapture(r.pointerId)};s.addEventListener("pointerdown",r=>{if(r.button!==0&&r.pointerType!=="touch")return;let d=e.getBoundingClientRect();n=r.clientX-d.left,o=r.clientY-d.top,e.classList.add("dragging"),e.style.zIndex=String(t()),window.addEventListener("pointermove",i),window.addEventListener("pointerup",c),r.pointerId!==void 0&&s.setPointerCapture(r.pointerId),r.preventDefault()})}function N(e,t,s){let n=document.getElementById(e);if(!n)return;n.style.opacity="1",n.style.display="block";let o=!0,i=window.setInterval(()=>{n.style.opacity=o?"1":"0",o=!o},t);window.setTimeout(()=>{window.clearInterval(i),n.style.opacity="0",n.style.display=""},s)}function M(){return{accessAttempts:0,active:null,commands:new Map,maxIndex:1,musicOn:!1,sounds:L()}}function p(e,t){let s=g(t.name);!s||e.commands.has(s)||e.commands.set(s,{...t,name:s})}function B(e,t){let s=e==null?void 0:e.querySelector(".command-history");if(!s)return;let n=document.createElement("div");n.className="entered-command",n.textContent=`> ${t}`,s.append(n)}function y(e){let t=document.getElementById("main-input");if(!t)return;typeof e=="string"?t.insertAdjacentHTML("beforeend",e):e instanceof Node&&t.append(e);let s=document.getElementById("main-inner");w(s)}function u(e,t="span"){let s=document.createElement(t);return s.textContent=e,y(s),s}function j(e){let t=document.createElement("div");return t.innerHTML=`
    <div>${e} containment enclosure....</div>
    <table id="system-output"><tbody>
      <tr><td>Security</td><td>[OK]</td></tr>
      <tr><td>Fence</td><td>[OK]</td></tr>
      <tr><td>Feeding Pavilion</td><td>[OK]</td></tr>
    </tbody></table>
  `,t}function H(e){p(e,{name:"music",summary:"turn background music on or off",manPage:["SYNOPSIS","	music [on|off]","","DESCRIPTION","	Manage the state of the 'Dennis Steals the Embryo' music. Use the 'on' state for","	increased epicness.","","AUTHOR",'	Written by <a href="https://tully.io">Tully Robinson</a>.'].join(`
`),execute(t,s){let[,n=""]=s.trim().split(/ +/);if(!n||!/^(?:on|off)$/i.test(n)){u("music: must specify state [on|off]");return}n.toLowerCase()==="on"?(t.musicOn||t.sounds.dennisMusic.play(),t.musicOn=!0):(t.sounds.dennisMusic.stop(),t.musicOn=!1)}}),p(e,{name:"access",summary:"access a target environment on the Jurassic Systems grid",manPage:["SYNOPSIS","	access [SYSTEM_NAME] [MAGIC_WORD]","","DESCRIPTION","	Gain read and write access to a specified environment.","","AUTHOR","	Written by Dennis Nedry."].join(`
`),execute(t,s){var l;let n=s.trim().split(/ +/),o=(l=n[1])!=null?l:"",i=n.length>2?n[n.length-1]:"";if(!o){u("access: must specify target system");return}if(n.length>2&&i.toLowerCase()==="please"){let a=document.createElement("img");a.id="asciiNewman",a.src="/img/asciiNewman.jpg",a.alt="ASCII art of Dennis Nedry",a.addEventListener("load",()=>{let m=document.querySelector("#main-terminal .inner-wrap");w(m)}),y(a);return}if(u("access: PERMISSION DENIED."),t.sounds.beep.play(),t.accessAttempts+=1,t.accessAttempts<3)return;let c=document.getElementById("main-prompt");c==null||c.classList.add("hide"),I();let r;u("...and...","span").classList.add("and-message"),window.setTimeout(()=>{t.sounds.lockDown.play()},1e3),window.setTimeout(()=>{let a=document.getElementById("environment");if(!a)return;let T=(parseFloat(window.getComputedStyle(a).left||"0")||0)+3e3;a.style.transition="left 2000ms ease",a.style.left=`${T}px`;let b=()=>{a.removeEventListener("transitionend",b),window.setTimeout(()=>{let k=document.getElementById("the-king-video");if(k){let f=k.play();f instanceof Promise&&f.catch(()=>{})}window.clearInterval(r);let x=document.getElementById("irix-desktop"),A=document.getElementById("mac-hd-window"),h=document.getElementById("the-king-window");x&&(x.style.display="none"),A&&(A.style.backgroundImage="url('/img/macHDBlur.jpg')"),h&&(h.style.display="block",h.setAttribute("aria-hidden","false")),window.setTimeout(()=>{let f=document.getElementById("home-key");f&&(f.style.zIndex="64000")},1e4)},2e3)};a.addEventListener("transitionend",b)},2e3),window.setTimeout(()=>{r=window.setInterval(()=>{let a=document.createElement("div");a.textContent="YOU DIDN'T SAY THE MAGIC WORD!",y(a)},50)},1e3)}}),p(e,{name:"system",summary:"check a system's current status",manPage:["SYNOPSIS","	system [SYSTEM_NAME]","","DESCRIPTION","	Check the input system and return each sector's current status.","","AUTHOR","	Written by Dennis Nedry."].join(`
`),execute(t,s){var a;let o=(a=s.trim().split(/ +/)[1])!=null?a:"";if(!o){y("<span>system: must specify target system</span>");return}let i=`${o.replace(/s$/i,"")}`,r=`${i.charAt(0).toUpperCase()}${i.slice(1)}`.replace(/[&<>"]+/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[m]),d=j(r);y(d);let l=document.querySelector("#main-terminal .inner-wrap");t.sounds.beep.play(),window.setTimeout(()=>{t.sounds.beep.play(),u("System Halt!","div"),w(l);let m=document.getElementById("main-prompt");m==null||m.classList.remove("hide")},900)}}),p(e,{name:"ls",summary:"list files in the current directory",manPage:["SYNOPSIS","	ls [FILE] ...","","DESCRIPTION","	List information about the FILEs (the current directory by default).","","AUTHOR","	Written by Richard Stallman and David MacKenzie."].join(`
`),execute(){u("zebraGirl.jpg","div")}}),p(e,{name:"display",summary:"display image files (hint: use ls to find a 'file')",manPage:["SYNOPSIS","	display file ...","","DESCRIPTION","	Display is a machine architecture independent image processing and display program. It can display an image on any workstation screen running an X server.","","AUTHOR","	John Cristy, ImageMagick Studio."].join(`
`),execute(t,s){if(s.trim().split(/ +/).length<2){u("display: no file specified");return}/zebraGirl\.jpg/i.test(s)&&window.setTimeout(()=>{let o=document.getElementById("zebra-girl");o&&(o.style.zIndex=String(t.maxIndex+=1),o.style.display="block",o.setAttribute("aria-hidden","false"),I())},300)}}),p(e,{name:"keychecks",summary:"display system level command history",manPage:["SYNOPSIS","	keychecks","","DESCRIPTION","	A system level command log used for accountability purposes. keychecks must be activated or deactivated via the main board."].join(`
`),execute(){let t=["13,42,121,32,88,77,19,13,44,52,77,90,13,99,13,100,13,109,55,103,144,13,99,87,60,13,44,12,09,13,43,63,13,46,57,89,103,122,13,44,52,88,931,13,21,13,57,98,100,102,103,13,112,13,146,13,13,13,77,67,88,23,13,13","system","nedry","go to command level","nedry","040/#xy/67&","mr goodbytes","security","keycheck off","safety off","sl off","security","whte_rbt.obj"].join(`
`);u(t,"div")}}),p(e,{name:"man",summary:"display reference manual for a given command",manPage:["SYNOPSIS","	man title ...","","DESCRIPTION","	man locates and prints the titled entries from the on-line reference manuals."].join(`
`),execute(t,s){var c;let o=(c=s.trim().split(/ +/)[1])!=null?c:"";if(!o){u("What manual page do you want?");return}let i=g(o);if(t.commands.has(i))y(t.commands.get(i).manPage.replace(/\n/g,"<br>"));else{let r=o.replace(/[&<>"]+/g,d=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[d]);u(`No manual entry for ${r}`)}}}),p(e,{name:"help",summary:"list available commands",manPage:["SYNOPSIS","	help","","DESCRIPTION","	Display a command summary for Jurassic Systems.","","AUTHOR",'	Written by <a href="https://tully.io">Tully Robinson</a>.'].join(`
`),execute(t){for(let[,s]of t.commands){let n=document.createElement("div");n.textContent=`${s.name} - ${s.summary}`,y(n)}}})}function $(e){document.querySelectorAll(".irix-window").forEach(n=>{P(n,()=>(e.maxIndex+=1,e.maxIndex)),n.addEventListener("click",o=>{o.stopPropagation(),I(),e.active=n;let i=n.querySelector(".buffer");i==null||i.focus(),n.style.zIndex=String(e.maxIndex+=1),n.querySelectorAll(".cursor").forEach(c=>{c.classList.add("active-cursor")})})}),document.querySelectorAll(".irix-window .buffer").forEach(n=>{n.addEventListener("keydown",o=>{var r;let i=n.closest(".irix-window");if(!i)return;if(o.key==="Enter"){o.preventDefault();let d=n.value;if(n.value="",B(i,d||" "),i.id==="chess-terminal"){let l=document.getElementById("curr-chess-input");l&&(l.textContent="")}else{let l=document.getElementById("curr-main-input");l&&(l.textContent="");let a=g((r=d.trim().split(/ +/)[0])!=null?r:""),m=e.commands.get(a);m&&typeof m.execute=="function"?m.execute(e,d):a&&u(`${d.trim().split(/ +/)[0]}: command not found`,"div")}}let c=i.querySelector(".inner-wrap");w(c)}),n.addEventListener("input",()=>{let o=n.closest(".irix-window");if(o)if(o.id==="chess-terminal"){let i=document.getElementById("curr-chess-input");i&&(i.textContent=n.value)}else{let i=document.getElementById("curr-main-input");i&&(i.textContent=n.value)}})})}function R(){window.setTimeout(()=>{let e=document.getElementById("irix-boot");e==null||e.remove();let t=document.getElementById("main-buffer");if(t==null||t.focus(),!window.location.pathname.includes("system")){t==null||t.blur();let s=document.getElementById("intro");if(s){s.style.display="block",s.setAttribute("aria-hidden","false");let n=document.getElementById("continue-button"),o=document.getElementById("intro-scene"),i=()=>{o instanceof HTMLIFrameElement&&(o.src=""),D(s,1e3),s.setAttribute("aria-hidden","true")};s.addEventListener("click",i,{once:!0}),n&&(n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label","Continue to console"),n.addEventListener("click",c=>{c.stopPropagation(),i()}),n.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),i())}))}}},4500)}function Y(e){document.body.addEventListener("click",()=>{I()}),window.addEventListener("keydown",s=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.key)&&s.preventDefault()});let t=document.getElementById("apple-desktop");t==null||t.addEventListener("click",s=>{let n=s.target;if(!(n instanceof Element))return;let o=n.closest(".mac-window");(!o||o.id!=="the-king-window")&&N("the-king-blur",50,450)})}function q(){O();let e=M();H(e),$(e),R(),Y(e)}document.addEventListener("DOMContentLoaded",q);})();
